{% extends 'core/base.html' %}

{% block title %}Welcome{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">

    <!-- HERO SECTION -->
    <section class="relative w-full h-[80vh] overflow-hidden rounded-3xl shadow-2xl mb-20 border border-white/20">

        <!-- Background Video -->
        <video autoplay loop muted playsinline class="absolute inset-0 w-full h-full object-cover brightness-[0.90]">
            <source src="media/bg_video.mp4" type="video/mp4">
        </video>

        <!-- Gradient Overlay -->
        <div class="absolute inset-0 bg-gradient-to-r from-primary/70 to-secondary/50"></div>

        <!-- Content -->
        <div class="relative z-20 h-full flex items-center justify-center px-6">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-2 items-center justify-center w-full max-w-6xl">

                <!-- LEFT TEXT -->
                <div class="text-center lg:text-right space-y-2">
                    <h1
                        class="text-4xl md:text-5xl lg:text-6xl font-extrabold text-white drop-shadow-lg leading-tight font-bubblegum">
                        Donâ€™t Miss <br> These Trending <br> Gifts
                    </h1>
                    <!-- <h1
                        class="text-4xl md:text-5xl lg:text-6xl font-extrabold text-accent drop-shadow-lg leading-tight font-bubblegum white-outline-text">
                        Gifts!</h1> -->
                    <p class="text-md md:text-lg text-gray-200 leading-relaxed max-w-md ml-auto font-poppins">
                        Handpicked, viral items that <br>everyone is talking about.<br>
                        Find your perfect gift today!
                    </p>
                </div>

                <!-- ROTATING ITEMS -->
                <div class="relative h-72 md:h-80 w-full flex justify-center lg:justify-center">

                    {% for item in popular_by_category %}
                    <div class="absolute inset-0 flex flex-col items-start pl-12 justify-start transition-all duration-700 opacity-0 transform scale-95 slide"
                        data-slide="{{ forloop.counter0 }}">

                        <!-- IMAGE WRAPPER WITH HOVER -->
                        <div
                            class="relative w-60 h-60 md:w-72 md:h-72 group rounded-3xl shadow-3xl border border-white/40 overflow-hidden">
                            <img src="{{ item.image.url }}" alt="{{ item.name }}"
                                class="w-full h-full object-cover transition-transform duration-500 hover:scale-110 rounded-3xl">

                            <!-- HOVER OVERLAY -->
                            <div
                                class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-opacity duration-300 rounded-3xl">
                                <a href="{% url 'item:detail' item.id %}"
                                    class="px-4 py-2 bg-primary text-white rounded-lg font-medium shadow-lg hover:bg-primary-dark transition">
                                    View Details
                                </a>
                            </div>
                        </div>

                        <!-- PRICE & DOTS -->
                        <div class="relative flex items-center justify-between space-x-4 w-60 pt-2 pl-6">
                            <p class="text-xl text-white font-bubblegum">
                                Only Rs. {{ item.price }}
                            </p>
                            <div class="flex space-x-2">
                                {% for dot in popular_by_category %}
                                <button
                                    class="w-2.5 h-2.5 rounded-full bg-white/40 hover:bg-white transition-all duration-300 slide-indicator"
                                    data-indicator="{{ forloop.counter0 }}">
                                </button>
                                {% endfor %}
                            </div>
                        </div>

                    </div>
                    {% endfor %}

                </div>

            </div>
        </div>

    </section>

    <!-- CAROUSEL JS -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const slides = document.querySelectorAll('.slide');
            const indicators = document.querySelectorAll('.slide-indicator');
            let currentSlide = 0;
            let slideInterval;

            function showSlide(index) {
                slides.forEach((slide, i) => {
                    const active = i === index;
                    slide.classList.toggle('opacity-100', active);
                    slide.classList.toggle('scale-100', active);
                    slide.classList.toggle('pointer-events-auto', active);
                    slide.classList.toggle('opacity-0', !active);
                    slide.classList.toggle('scale-95', !active);
                    slide.classList.toggle('pointer-events-none', !active);
                    slide.style.zIndex = active ? '10' : '1';
                });

                indicators.forEach((indicator, i) => {
                    const active = i === index;
                    indicator.classList.toggle('bg-white', active);
                    indicator.classList.toggle('w-8', active);
                    indicator.classList.toggle('bg-white/40', !active);
                    indicator.classList.toggle('w-2.5', !active);
                });

                currentSlide = index;
            }

            function nextSlide() {
                showSlide((currentSlide + 1) % slides.length);
            }

            showSlide(0);
            slideInterval = setInterval(nextSlide, 2500);

            indicators.forEach((indicator, index) => {
                indicator.addEventListener('click', () => {
                    clearInterval(slideInterval);
                    showSlide(index);
                    slideInterval = setInterval(nextSlide, 2500);
                });
            });
        });
    </script>

    <!-- NEWEST ITEMS -->
    <section class="mb-20 font-poppins">
        <div class="flex justify-between items-center mb-10">
            <h2 class="text-4xl font-bubblegum text-primary">Newest Items</h2>
            <a href="{% url 'item:items' %}"
                class="text-secondary hover:text-primary font-medium flex items-center transition-all">
                View All <i class="fas fa-arrow-right ml-2"></i>
            </a>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {% for item in items %}
            <div
                class="bg-white rounded-3xl overflow-hidden shadow-lg hover:shadow-2xl transition-all border border-gray-200 hover:-translate-y-1">
                <a href="{% url 'item:detail' item.id %}">
                    <div class="relative h-56 overflow-hidden">
                        <img src="{{ item.image.url }}" alt="{{ item.name }}"
                            class="w-full h-full object-cover transition-transform duration-500 hover:scale-110" />
                        <span
                            class="absolute top-3 right-3 bg-secondary text-white text-xs px-3 py-1 rounded-full shadow-lg">
                            New
                        </span>
                    </div>

                    <div class="p-6">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="text-xl font-semibold text-primary">{{ item.name }}</h3>
                            <span class="text-lg font-bold text-primary">Rs {{ item.price }}</span>
                        </div>

                        <p class="text-gray-600 text-sm mb-4">
                            {{ item.description|truncatewords:15 }}
                        </p>

                        <div class="flex justify-between items-center">
                            <span class="text-xs text-gray-400">
                                <i class="far fa-clock mr-1"></i>
                                Added {{ item.created_at|date:"M d, Y" }}
                            </span>

                            <span class="text-sm text-primary hover:text-secondary font-medium flex items-center">
                                View <i class="fas fa-arrow-right ml-1"></i>
                            </span>
                        </div>
                    </div>
                </a>
            </div>
            {% empty %}
            <div class="col-span-3 text-center py-12">
                <i class="fas fa-box-open text-5xl text-gray-300 mb-4"></i>
                <h3 class="text-xl font-medium text-gray-700 mb-2">No items available</h3>
                <p class="text-gray-500 mb-6">Be the first to add an item!</p>
                <a href="{% url 'item:new' %}" class="btn-primary text-sm px-4 py-2 rounded-xl shadow-md">
                    Add New Item
                </a>
            </div>
            {% endfor %}
        </div>
    </section>

    <!-- CATEGORIES -->
    <section class="font-poppins mb-20">
        <div class="flex justify-between items-center mb-10">
            <h2 class="text-4xl font-bubblegum text-primary">Browse Categories</h2>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {% for category in categories %}
            <a href="{% url 'item:items' %}?category={{ category.id }}" class="block group">
                <div
                    class="bg-white/70 backdrop-blur-xl rounded-3xl p-6 shadow-lg border border-primary-light/40 group-hover:border-primary/70 transition-all duration-300 hover:-translate-y-1">
                    <div class="flex items-center mb-4">
                        <div
                            class="w-14 h-14 rounded-xl gradient-primary flex items-center justify-center shadow-md mr-4">
                            <i class="fas fa-gift text-white text-2xl"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-primary">
                            {{ category.name }}
                        </h3>
                    </div>

                    <p class="text-gray-600 mb-3">
                        {{ category.unsold_count }} item{{ category.unsold_count|pluralize }}
                    </p>

                    <div class="flex justify-between items-center">
                        <span class="text-sm text-secondary font-medium">Browse category</span>
                        <i class="fas fa-arrow-right text-secondary"></i>
                    </div>
                </div>
            </a>
            {% empty %}
            <div class="col-span-3 text-center py-12">
                <i class="fas fa-folder-open text-5xl text-gray-300 mb-4"></i>
                <h3 class="text-xl font-medium text-gray-700 mb-2">No categories available</h3>
                <p class="text-gray-500">Categories will appear here once created.</p>
            </div>
            {% endfor %}
        </div>
    </section>

</div>
{% endblock %}